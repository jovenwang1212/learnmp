(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pay/main"],{"2f76":function(e,t,o){},"41ff":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},r=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return r})},"5aa7":function(e,t,o){"use strict";var n=o("2f76"),r=o.n(n);r.a},"7a53":function(e,t,o){"use strict";(function(e,o){function n(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){r(e,t,o[t])})}return e}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={data:function(){return{address:wx.getStorageSync("address")||{},goodsList:[]}},onLoad:function(e){this.goodsId=e.goodsId,this.getGoodsList()},methods:{pay:function(){this.address.userName?this.totalPrice?this.createOrder():wx.showToast({title:"请选择商品",icon:"none"}):wx.showToast({title:"请选择收货地址",icon:"none"})},createOrder:function(){var e=this;this.$request({url:"/api/public/v1/my/orders/create",method:"POST",isAuth:!0,data:{order_price:this.totalPrice,consignee_addr:this.detailAddr,goods:this.filterGoodsList()}}).then(function(t){e.orderNumber=t.order_number,e.gooodsId||e.arrangeCart(),e.doPay()})},arrangeCart:function(){this.$store.commit("arrangeCart")},doPay:function(){var t=this;this.$request({url:"/api/public/v1/my/orders/req_unifiedorder",method:"POST",isAuth:!0,data:{order_number:this.orderNumber}}).then(function(o){console.log(e(o," at pages\\pay\\main.vue:109")),wx.requestPayment(n({},o.pay,{success:function(e){wx.navigateTo({url:"/pages/order_result/main"})},fail:function(o){console.log(e("支付失败"," at pages\\pay\\main.vue:117")),wx.navigateTo({url:"/pages/order_result/main?orderNumber="+t.orderNumber})}}))})},filterGoodsList:function(){var e=[];return this.goodsList.forEach(function(t){e.push({goods_id:t.goods_id,goods_number:t.num,goods_price:t.goods_price})}),e},filterCart:function(e){var t=[];for(var o in e){var n=e[o];n.checked&&t.push(o)}return t.join(",")},getGoodsList:function(){var e=this,t=this.$store.getters.getCart;this.goodsId&&(t=r({},this.goodsId,{num:1,checked:!0}));var o=this.filterCart(t);o&&this.$request({url:"/api/public/v1/goods/goodslist?goods_ids="+o}).then(function(o){o.forEach(function(e){e.num=t[e.goods_id].num,e.checked=t[e.goods_id].checked}),e.goodsList=o})},getAddr:function(){var t=this;o.getSetting({success:function(n){console.log(e(n," at pages\\pay\\main.vue:176")),!1===n.authSetting["scope.address"]?o.showModal({title:"提示",content:"请打开设置允许通讯地址",showCancel:!0,cancelText:"取消",cancelColor:"#000000",confirmText:"确定",confirmColor:"#3CC51F",success:function(e){e.confirm&&o.openSetting()}}):o.authorize({scope:"scope.address",success:function(){o.chooseAddress({success:function(n){console.log(e(n," at pages\\pay\\main.vue:201")),t.address=n,o.setStorageSync("address",n)}})}})}})}},computed:{detailAddr:function(){var e=this.address,t=e.provinceName,o=e.cityName,n=e.countyName,r=e.detailInfo;return t+o+n+r},totalPrice:function(){return this.goodsList.reduce(function(e,t){return e+t.num*t.goods_price},0)}}};t.default=s}).call(this,o("0de9")["default"],o("6e42")["default"])},8432:function(e,t,o){"use strict";o.r(t);var n=o("7a53"),r=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,function(){return n[e]})}(s);t["default"]=r.a},cfb1:function(e,t,o){"use strict";(function(e){o("8c5f"),o("921b");n(o("66fd"));var t=n(o("deda"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},deda:function(e,t,o){"use strict";o.r(t);var n=o("41ff"),r=o("8432");for(var s in r)"default"!==s&&function(e){o.d(t,e,function(){return r[e]})}(s);o("5aa7");var i=o("2877"),a=Object(i["a"])(r["default"],n["a"],n["b"],!1,null,null,null);t["default"]=a.exports}},[["cfb1","common/runtime","common/vendor"]]]);